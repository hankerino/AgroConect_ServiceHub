<!DOCTYPE html>
<html>
<head>
  <title>Test TTS</title>
</head>
<body>
  <h1>Test Text-to-Speech</h1>
  <button id="testBtn">Test Voice</button>
  <div id="status"></div>
  <audio id="audio" controls></audio>

  <script>
    const SUPABASE_URL = 'https://gnsadfgdvowjevkutdmp.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imduc2FkZmdkdm93amV2a3V0ZG1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NjYwMDMsImV4cCI6MjA2NjM0MjAwM30.uiwBu8u_vrgOstSC3BAcNkFK-tJCtzrGeqDbVB2G2jk';

    document.getElementById('testBtn').addEventListener('click', async () => {
      const status = document.getElementById('status');
      const audio = document.getElementById('audio');

      status.innerHTML = 'Testing...';

      try {
        const response = await fetch(`${SUPABASE_URL}/functions/v1/text-to-speech`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ text: 'Olá, este é um teste de voz' })
        });

        status.innerHTML += '<br>Response status: ' + response.status;
        status.innerHTML += '<br>Response headers: ' + JSON.stringify(Object.fromEntries(response.headers.entries()));

        if (!response.ok) {
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
            const error = await response.json();
            status.innerHTML += '<br>Error: ' + JSON.stringify(error);
          } else {
            const error = await response.text();
            status.innerHTML += '<br>Error: ' + error;
          }
          return;
        }

        const blob = await response.blob();
        status.innerHTML += '<br>Audio blob size: ' + blob.size + ' bytes';

        const url = URL.createObjectURL(blob);
        audio.src = url;
        audio.play();

        status.innerHTML += '<br>SUCCESS! Playing audio...';
      } catch (error) {
        status.innerHTML += '<br>Exception: ' + error.message;
        console.error(error);
      }
    });
  </script>
</body>
</html>
