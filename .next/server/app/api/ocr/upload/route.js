"use strict";(()=>{var e={};e.id=358,e.ids=[358],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6025:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v});var o={};t.r(o),t.d(o,{POST:()=>p,dynamic:()=>d});var a=t(986),s=t(4478),n=t(8372),i=t(8157);let l=process.env.NVIDIA_API_KEY;async function c(e){if(!l)throw Error("NVIDIA_API_KEY is not configured. Please add it to your environment variables.");try{let r=await fetch("https://integrate.api.nvidia.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({model:"nvidia/nemoretriever-ocr-v1",messages:[{role:"user",content:[{type:"image_url",image_url:{url:`data:image/jpeg;base64,${e}`}},{type:"text",text:"Extract all text from this image."}]}],max_tokens:1024,temperature:.2,stream:!1})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(`NVIDIA OCR API error: ${r.status} - ${e.message||"Unknown error"}`)}let t=await r.json();return t.choices?.[0]?.message?.content||""}catch(e){throw console.error("[v0] NVIDIA OCR error:",e),e}}l||console.warn("[v0] NVIDIA_API_KEY not found. OCR functionality will not work.");var u=t(4433);async function p(e){try{console.log("[v0] OCR upload request received");let r=await e.formData(),t=r.get("image"),o=r.get("userId"),a=r.get("analysisType")||"general";if(!t)return i.NextResponse.json({error:"No image file provided"},{status:400});if(!t.type.startsWith("image/"))return i.NextResponse.json({error:"File must be an image"},{status:400});console.log("[v0] Processing image:",t.name,t.type);let s=await t.arrayBuffer(),n=Buffer.from(s).toString("base64");console.log("[v0] Calling NVIDIA OCR API...");let l=await c(n);console.log("[v0] Text extracted, length:",l?.length||0);let{data:p,error:d}=await u.O.from("SoilAnalysis").insert({user_id:o,analysis_type:a,ocr_text:l,status:"completed",created_at:new Date().toISOString()}).select().single();if(d)throw console.error("[v0] Database error:",d),d;return console.log("[v0] OCR analysis saved to database"),i.NextResponse.json({success:!0,data:{id:p.id,extractedText:l,analysis:p}})}catch(e){return console.error("[v0] OCR upload error:",e),i.NextResponse.json({error:e instanceof Error?e.message:"Failed to process image",details:e instanceof Error?e.stack:void 0},{status:500})}}let d="force-dynamic",g=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ocr/upload/route",pathname:"/api/ocr/upload",filename:"route",bundlePath:"app/api/ocr/upload/route"},resolvedPagePath:"/Users/hankerino/AgroConect_ServiceHub/app/api/ocr/upload/route.ts",nextConfigOutput:"export",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:f}=g,A="/api/ocr/upload/route";function _(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},5980:(e,r,t)=>{t.d(r,{O:()=>n});var o=t(3384);let a=process.env.NEXT_PUBLIC_SUPABASE_URL,s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(console.log("[v0] Supabase URL exists:",!!a),console.log("[v0] Supabase Anon Key exists:",!!s),!a||!s)throw console.error("[v0] Missing Supabase environment variables"),Error("Missing Supabase environment variables. Please add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to your environment.");let n=(0,o.eI)(a,s)},4433:(e,r,t)=>{t.d(r,{O:()=>o.O});var o=t(5980)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[553,473,384],()=>t(6025));module.exports=o})();